$(function(){var a=function(){function a(a,b,c){this.initialized(a,b,c),this.listener()}return a.prototype.initialized=function(a,b,c){this.alredy_count=!1,this.$target=$(a),this.event=b,this.api={url:c,data:this.$target.data("id")}},a.prototype.listener=function(){var a=this;this.$target.on(this.event,function(){a.count(this)})},a.prototype.count=function(){return this.alredy_count?0:(this.alredy_count=!0,void $.get(this.api.url,{id:this.api.data}))},a}(),b=function(){var b=function(b){a.call(this,b,"click","dl_count")};return b}(),c=function(){var b=function(b){a.call(this,b,"play","play_count")};return b}();Object.setPrototypeOf(b.prototype,a.prototype),Object.setPrototypeOf(c.prototype,a.prototype),$(".downloads a").each(function(){new b(this)}),$(".audio").each(function(){new c(this)});var d=function(){function a(a){this.initialized(a),this.listener()}return a.prototype.initialized=function(a){this.$target=$(a),this.$sound_dom=$("#sound-id-"+this.$target.data("id")),this.$comment_form=this.$sound_dom.find(".comment_form"),this.data_id=this.$target.data("id"),this.user_id=this.get_cookie("user_id");var b=this;$.get("get_comment_count",{data_id:this.data_id},function(a){b.comment_count=a})},a.prototype.listener=function(){var a=this;this.$comment_form.on("keyup",function(b){b.ctrlKey&&13==b.keyCode&&a.$target.trigger("click")}),this.$target.on("click",function(){a.$target.hasClass("disabled")||(a.send_message(a.$comment_form.val()),a.show_comment(a.$comment_form.val()),a.$comment_form.val(""))})},a.prototype.send_message=function(a){a=this.trim_space_and_br(a),$.get("send_comment",{comment:a,data_id:this.data_id,user_id:this.user_id})},a.prototype.trim_space_and_br=function(a){return a.replace(/(^\s+|\s+$)|(^\n+|\n+$)/g,"")},a.prototype.show_comment=function(a){var a='<p class="comment_text">'+a+"</p>";this.$sound_dom.find(".comments").prepend(a)},a.prototype.get_cookie=function(a){for(var b=document.cookie.split(";"),c=0;c<b.length;c++)if(b[c].substr(0,a.length)==a)return b[c].split("=")[1];return null},a}();$(".comment_submit").each(function(){new d(this)});var e=function(){function a(a){this.initialized(a),this.listener()}return a.prototype.initialized=function(a){this.$target=$(a),this.$sound_dom=$("#sound-id-"+this.$target.data("id")),this.$submit=this.$sound_dom.find(".comment_submit"),this.data_id=this.$target.data("id"),this.validates={empty:"",space:/( |ã€€)/,br:/\n/}},a.prototype.listener=function(){var a=this;this.$target.on("focus",function(){a.$target.trigger("keyup")}),this.$target.on("focusout",function(){a.$target.parent().removeClass("has-error")}),this.$target.on("keyup",function(){a.check()})},a.prototype.check=function(){for(key in this.validates)this[key](this.$target.val())?this.valid():this.invalid()},a.prototype.empty=function(a){return a!=this.validates.empty},a.prototype.space=function(a){for(var b=0;b<a.length;b++)if(!a[b].match(this.validates.space))return!0;return!1},a.prototype.br=function(a){for(var b=0;b<a.length;b++)if(!a[b].match(this.validates.br))return!0;return!1},a.prototype.valid=function(){this.$submit.removeClass("disabled"),this.$target.parent().removeClass("has-error")},a.prototype.invalid=function(){this.$submit.addClass("disabled"),this.$target.parent().addClass("has-error")},a}();$(".comment_form").each(function(){new e(this)})});